<div class="order-tracking">
  <div *ngIf="isLoading" class="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading order details...</p>
  </div>

  <div *ngIf="error" class="error">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <div *ngIf="order" class="order-details">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Order #{{ order.orderNumber }}</mat-card-title>
        <mat-card-subtitle>Estimated delivery: {{ order.estimatedDelivery | date:'short' }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="status-timeline">
          <div class="timeline">
            <div *ngFor="let status of statuses" class="timeline-step" [class.completed]="status.completed" [class.active]="status.active">
              <div class="timeline-icon">
                <mat-icon>{{ status.icon }}</mat-icon>
              </div>
              <div class="timeline-content">
                <h4>{{ status.status }}</h4>
                <p>{{ status.description }}</p>
                <span class="timeline-time">{{ status.timestamp | date:'shortTime' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="map-container" *ngIf="markerPosition">
          <google-map
            [options]="mapOptions"
            (mapInitialized)="onMapReady($event)"
            [style.height.px]="200"
            [style.width]="'100%'"
          >
            <map-marker
              [position]="markerPosition"
              [options]="{ 
                icon: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png'
              }"
            ></map-marker>

            <map-marker
              *ngIf="deliveryPersonPosition"
              [position]="deliveryPersonPosition"
              [options]="{
                icon: {
                  url: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png',
                  scaledSize: new google.maps.Size(40, 40)
                }
              }"
            ></map-marker>

            <map-polyline
              *ngIf="deliveryPath.length > 1"
              [path]="deliveryPath"
              [options]="{
                strokeColor: '#1976d2',
                strokeOpacity: 1.0,
                strokeWeight: 3
              }"
            ></map-polyline>
          </google-map>
        </div>

        <div class="delivery-info">
          <h3>Delivery Details</h3>
          <div class="info-row">
            <span class="label">Delivery to:</span>
            <span class="value">{{ order.deliveryAddress }}</span>
          </div>
          <div class="info-row">
            <span class="label">Order Total:</span>
            <span class="value">â‚¹{{ order.total | number:'1.2-2' }}</span>
          </div>
          <div class="info-row" *ngIf="order.deliveryPerson">
            <span class="label">Delivery Partner:</span>
            <span class="value">{{ order.deliveryPerson.name }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>