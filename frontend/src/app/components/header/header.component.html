<header class="header">
  <div class="container">
    <div class="nav-brand">
      <a routerLink="/" class="logo">
        <!-- <span class="logo-text">Protein Grub Hub</span> -->
        <!-- e.g., in app.component.html or a header component -->
        <img class="logo-light-variant" src="assets/logo-protein-grub-hub-horizontal-dark.svg" alt="Protein Grub Hub" style="height:70px" />
        <img class="logo-dark-variant" src="assets/logo-protein-grub-hub-horizontal.svg" alt="Protein Grub Hub" style="height:70px" />
      </a>
    </div>

  <button class="mobile-menu-toggle" [attr.aria-label]="'Toggle navigation menu'" aria-controls="nav-menu" [attr.aria-expanded]="isNavOpen" (click)="toggleNavMenu()">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <nav class="nav-menu" id="nav-menu" [class.active]="isNavOpen" [attr.aria-hidden]="!isNavOpen">
      <ul class="nav-list">
        <li><a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Home</a></li>
        <li><a routerLink="/meals" routerLinkActive="active">Browse Meals</a></li>
        <li><a routerLink="/supplements" routerLinkActive="active">Supplements</a></li>
        @if (currentUser$ | async) {
          <li><a routerLink="/dashboard" routerLinkActive="active">Dashboard</a></li>
        }
        <li class="theme-toggle-container">
          <button mat-icon-button class="theme-toggle" (click)="toggleTheme()" [title]="(isDark$ | async) ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
            <mat-icon>{{ (isDark$ | async) ? 'light_mode' : 'dark_mode' }}</mat-icon>
          </button>
        </li>
      </ul>
    </nav>

    <div class="nav-actions">
      <!-- Cart icon visible only for authenticated users -->
      @if (currentUser$ | async) {
        <a routerLink="/cart" class="nav-action-icon" title="Cart">
          üõí
          @if (cartItemCount$ | async; as count) {
            <span class="cart-count">{{ count }}</span>
          }
        </a>
      }

      <!-- Animated Diet Mode Toggle -->
      @if (currentUser$ | async) {
        <div class="diet-toggle-container" (click)="cycleDiet()" [title]="'Current: ' + (diet === 'veg' ? 'Vegetarian' : diet === 'nonveg' ? 'Non-Vegetarian' : 'All Foods')">
          <div class="diet-toggle" [class.veg]="diet === 'veg'" [class.nonveg]="diet === 'nonveg'" [class.neutral]="diet === 'neutral'">
            <div class="diet-icon">
              @if (diet === 'veg') {
                <span class="veg-icon">üå±</span>
              } @else if (diet === 'nonveg') {
                <span class="nonveg-icon">üçó</span>
              } @else {
                <span class="neutral-icon">üçΩÔ∏è</span>
              }
            </div>
            <span class="diet-label">
              @switch (diet) {
                @case ('veg') { Veg }
                @case ('nonveg') { Non-Veg }
                @default { All }
              }
            </span>
          </div>
        </div>
      }
      
      @if (currentUser$ | async; as user) {
        <div class="user-menu" (click)="$event.stopPropagation()">
          <button class="user-button" (click)="toggleUserMenu($event)" [attr.aria-label]="'Open user menu for ' + (user.name || user.email)" [attr.aria-expanded]="isUserMenuOpen">
            <app-nav-avatar
              [avatar]="user.avatar"
              [userName]="user.name || user.email"
              size="sm">
            </app-nav-avatar>
            <span class="user-name">{{ user.name || user.email }}</span>
            <mat-icon>expand_more</mat-icon>
          </button>
          
          @if (isUserMenuOpen) {
            <div class="dropdown-menu show" (click)="$event.stopPropagation()">
              <a routerLink="/profile" class="dropdown-item">
                <mat-icon>account_circle</mat-icon> My Profile
              </a>
              <a routerLink="/orders" class="dropdown-item">
                <mat-icon>receipt</mat-icon> My Orders
              </a>
              <a routerLink="/settings" class="dropdown-item">
                <mat-icon>settings</mat-icon> Settings
              </a>
              <div class="dropdown-divider"></div>
              <button class="dropdown-item" (click)="logout()">
                <mat-icon>logout</mat-icon> Logout
              </button>
            </div>
          }
        </div>
      } @else {
        <div class="login-buttons">
          <a routerLink="/login" class="login-btn">Login</a>
          <a routerLink="/signup" class="signup-btn">Sign Up</a>
        </div>
      }
    </div>
  </div>
</header>
